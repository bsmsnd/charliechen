<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SSH连接失败的问题和解决思路 | Charlie 的菜地</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="这是我的第一个 VuePress 站点">
    
    <link rel="preload" href="/charliechen/assets/css/0.styles.9ed93ac4.css" as="style"><link rel="preload" href="/charliechen/assets/js/app.eeb45abd.js" as="script"><link rel="preload" href="/charliechen/assets/js/2.9e3e1986.js" as="script"><link rel="preload" href="/charliechen/assets/js/1.0ca782be.js" as="script"><link rel="preload" href="/charliechen/assets/js/25.16102229.js" as="script"><link rel="prefetch" href="/charliechen/assets/js/10.ce35871e.js"><link rel="prefetch" href="/charliechen/assets/js/11.487e5cfe.js"><link rel="prefetch" href="/charliechen/assets/js/12.e59c377a.js"><link rel="prefetch" href="/charliechen/assets/js/13.7412fbaf.js"><link rel="prefetch" href="/charliechen/assets/js/14.18db4e12.js"><link rel="prefetch" href="/charliechen/assets/js/15.3642faa9.js"><link rel="prefetch" href="/charliechen/assets/js/16.2dbc6bf5.js"><link rel="prefetch" href="/charliechen/assets/js/17.d01e6ecb.js"><link rel="prefetch" href="/charliechen/assets/js/18.282a9589.js"><link rel="prefetch" href="/charliechen/assets/js/19.9f389a20.js"><link rel="prefetch" href="/charliechen/assets/js/20.c55ac021.js"><link rel="prefetch" href="/charliechen/assets/js/21.fcedc201.js"><link rel="prefetch" href="/charliechen/assets/js/22.ed46aa09.js"><link rel="prefetch" href="/charliechen/assets/js/23.a8fbb0dd.js"><link rel="prefetch" href="/charliechen/assets/js/24.f417b5f6.js"><link rel="prefetch" href="/charliechen/assets/js/26.ce2fdeff.js"><link rel="prefetch" href="/charliechen/assets/js/27.dbd516a3.js"><link rel="prefetch" href="/charliechen/assets/js/28.c3902974.js"><link rel="prefetch" href="/charliechen/assets/js/29.ee2cc093.js"><link rel="prefetch" href="/charliechen/assets/js/3.8ebc9574.js"><link rel="prefetch" href="/charliechen/assets/js/4.6bce27c6.js"><link rel="prefetch" href="/charliechen/assets/js/5.7dd73af3.js"><link rel="prefetch" href="/charliechen/assets/js/6.f789e276.js"><link rel="prefetch" href="/charliechen/assets/js/7.478ed928.js"><link rel="prefetch" href="/charliechen/assets/js/vendors~docsearch.271bc088.js">
    <link rel="stylesheet" href="/charliechen/assets/css/0.styles.9ed93ac4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/charliechen/" class="home-link router-link-active"><img src="/charliechen/logo.png" alt="Charlie 的菜地" class="logo"> <span class="site-name can-hide">Charlie 的菜地</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/charliechen/leetcode_solutions/" class="nav-link">
  刷题
</a></div><div class="nav-item"><a href="/charliechen/to_vuepress/" class="nav-link">
  Migrate To VuePress
</a></div><div class="nav-item"><a href="https://github.com/bsmsnd/charliechen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/charliechen/git/ssh_to_github_troubleshooting.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文🇨🇳
</a></li><li class="dropdown-item"><!----> <a href="/charliechen/en/" class="nav-link">
  English🇺🇸
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/charliechen/leetcode_solutions/" class="nav-link">
  刷题
</a></div><div class="nav-item"><a href="/charliechen/to_vuepress/" class="nav-link">
  Migrate To VuePress
</a></div><div class="nav-item"><a href="https://github.com/bsmsnd/charliechen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/charliechen/git/ssh_to_github_troubleshooting.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文🇨🇳
</a></li><li class="dropdown-item"><!----> <a href="/charliechen/en/" class="nav-link">
  English🇺🇸
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/charliechen/git/ssh_to_github_troubleshooting.html" aria-current="page" class="active sidebar-link">SSH连接失败的问题和解决思路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/charliechen/git/ssh_to_github_troubleshooting.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/charliechen/git/ssh_to_github_troubleshooting.html#事故现场" class="sidebar-link">事故现场</a></li><li class="sidebar-sub-header"><a href="/charliechen/git/ssh_to_github_troubleshooting.html#换用-443-端口" class="sidebar-link">换用 443 端口</a></li><li class="sidebar-sub-header"><a href="/charliechen/git/ssh_to_github_troubleshooting.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ssh连接失败的问题和解决思路"><a href="#ssh连接失败的问题和解决思路" class="header-anchor">#</a> SSH连接失败的问题和解决思路</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>最近笔者换了一台新的MacBook Pro M3 Pro 2023（不得不说，比Macbook Pro 2019 Intel I9的发热情况的改善不是一星半点，太香了！），重新整理代码仓库的时候发现，GitHub无法通过SSH连接了。这里记录下问题和最终的解决方案，供大家参考。</p> <h2 id="事故现场"><a href="#事故现场" class="header-anchor">#</a> 事故现场</h2> <ol><li><p>尝试克隆仓库失败</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~ <span class="token function">git</span> clone git@github.com:noahgift/flask-random-fruit.git

Cloning into <span class="token string">'flask-random-fruit'</span><span class="token punctuation">..</span>.
Connection closed by <span class="token number">140.82</span>.112.3 port <span class="token number">22</span>
fatal: Could not <span class="token builtin class-name">read</span> from remote repository.

Please <span class="token function">make</span> sure you have the correct access rights
and the repository exists.
</code></pre></div></li> <li><p>检查 ssh key 是否正确录入GitHub系统，且本地文件权限正确配置</p> <blockquote><p><strong>(1) Correct Permissions</strong></p> <ul><li><strong><code>.ssh</code> directory:</strong> <code>700</code> (owner has read, write, and execute permissions)</li> <li><strong><code>id_rsa</code> (or similar private key file):</strong> <code>600</code> (owner has read and write permissions)</li> <li><strong><code>authorized_keys</code>:</strong> <code>600</code> (owner has read and write permissions)</li> <li><strong>Other files (e.g., <code>known_hosts</code>, <code>config</code>):</strong> <code>600</code> is generally recommended, but you can adjust permissions based on your needs.</li></ul> <p><strong>(2) 如何将SSH key添加至GitHub</strong>：参见 <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account#adding-a-new-ssh-key-to-your-account" target="_blank" rel="noopener noreferrer">Adding a new SSH key to your GitHub account - GitHub Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p>通过<code>ssh -vT git@github.com</code>进一步诊断</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~ <span class="token function">ssh</span> <span class="token parameter variable">-vT</span> github.com

OpenSSH_9.7p1, LibreSSL <span class="token number">3.3</span>.6
debug1: Reading configuration data /Users/xxx/.ssh/config
<span class="token punctuation">..</span>.
debug1: Connecting to github.com port <span class="token number">22</span>.
debug1: Connection established.
debug1: identity <span class="token function">file</span> /Users/xxx/.ssh/id_xxx <span class="token builtin class-name">type</span> <span class="token number">3</span>
debug1: identity <span class="token function">file</span> /Users/xxx/.ssh/id_xxx-cert <span class="token builtin class-name">type</span> <span class="token parameter variable">-1</span>
debug1: Local version string SSH-2.0-OpenSSH_9.7
kex_exchange_identification: Connection closed by remote <span class="token function">host</span>
Connection closed by <span class="token number">140.82</span>.112.3 port <span class="token number">22</span>
</code></pre></div><p>其中，<code>debug1: identity file /Users/xxx/.ssh/id_xxx type 3</code>表示用于连接的SSH key已经找到，可用于KEX。</p> <p><code>debug1: identity file /Users/xxx/.ssh/id_xxx-cert type -1</code>这一行迷惑性较大，前期投入较长时间分析为什么没有生成对应的问题，后面发现此文件时在提供根证书的情况下才会生成，个人开发者生成的ssh key一般不存在此文件，无需处理。</p></li> <li><p>考虑到SSH key已经找到的情况下仍无法连接，搜索发现存在网络运营商禁用某些端口的情况。</p></li> <li><p>尝试换用443端口 (SSH over HTTPS) 连接GitHub，可以正常认证。</p></li></ol> <h2 id="换用-443-端口"><a href="#换用-443-端口" class="header-anchor">#</a> 换用 443 端口</h2> <p>打开<code>~/.ssh/config</code>文件，添加如下几行：</p> <div class="language- extra-class"><pre class="language-text"><code>Host github.com
  Hostname ssh.github.com
  AddKeysToAgent yes
  UseKeychain yes
  User git
  Port 443
  IdentityFile ~/.ssh/YOUR_PRIVATE_KEY
</code></pre></div><p>重新使用<code>ssh git@github.com</code>登录，提示可以正常认证：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~ <span class="token function">ssh</span> github.com

PTY allocation request failed on channel <span class="token number">0</span>
Hi xxx<span class="token operator">!</span> You've successfully authenticated, but GitHub does not provide shell access.
Connection to ssh.github.com closed.
</code></pre></div><h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><a href="https://blog.csdn.net/CoolBoySilverBullet/article/details/135736862" target="_blank" rel="noopener noreferrer">【日常踩坑】解决 kex_exchange_identification 报错_kex exchange identification-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.github.com/en/authentication/troubleshooting-ssh/error-permission-denied-publickey" target="_blank" rel="noopener noreferrer">Error: Permission denied (publickey) - GitHub Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.github.com/en/authentication/troubleshooting-ssh/using-ssh-over-the-https-port" target="_blank" rel="noopener noreferrer">Using SSH over the HTTPS port - GitHub Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/charliechen/assets/js/app.eeb45abd.js" defer></script><script src="/charliechen/assets/js/2.9e3e1986.js" defer></script><script src="/charliechen/assets/js/1.0ca782be.js" defer></script><script src="/charliechen/assets/js/25.16102229.js" defer></script>
  </body>
</html>
